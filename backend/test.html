<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wispr Test Client</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; }
    .msg { margin: 5px 0; }
    .sender { font-weight: bold; }
    .timestamp { color: gray; font-size: 0.8em; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Wispr WebSocket Chat</h1>

  <div>
    <label>Recipient: <input id="recipient" placeholder="Enter recipient username"></label>
  </div>
  <div style="margin-top:10px;">
    <input id="msg" placeholder="Type your message" size="40">
    <button onclick="send()">Send</button>
  </div>

  <h2>Chat</h2>
  <div id="chat"></div>

  <script>
    const username = prompt("Enter your username:");
    const ws = new WebSocket("ws://localhost:8080/ws?username=" + username);

    ws.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      const chat = document.getElementById("chat");

      const div = document.createElement("div");
      div.classList.add("msg");
      div.innerHTML = `<span class="timestamp">[${msg.timestamp}]</span> 
                       <span class="sender">${msg.sender}</span> â†’ ${msg.recipient}: ${msg.content}`;
      chat.appendChild(div);

      // auto-scroll
      chat.scrollTop = chat.scrollHeight;
    };

    function send() {
      const input = document.getElementById("msg");
      const recipientInput = document.getElementById("recipient");

      if (!recipientInput.value) {
        alert("Please enter a recipient!");
        return;
      }

      const msg = {
        sender: username,
        recipient: recipientInput.value,
        content: input.value,
        timestamp: new Date().toISOString()
      };

      ws.send(JSON.stringify(msg));
      input.value = "";
    }
  </script>
</body>
</html>
